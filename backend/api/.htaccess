# backend/api/.htaccess - Simple API routing

# Enable the rewrite engine
RewriteEngine On
RewriteBase /

# CORS is already handled in the VirtualHost configuration

# Handle direct access to PHP files
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Handle clean URL endpoints - with case insensitivity [NC]
RewriteRule ^preferences$ preferences.php [NC,L,QSA]
RewriteRule ^media$ media.php [NC,L,QSA]
RewriteRule ^tags$ tags.php [NC,L,QSA]
RewriteRule ^session$ session.php [NC,L,QSA]
RewriteRule ^track$ track.php [NC,L,QSA]

# Debug - log all requests to a file
RewriteLog "/var/www/html/my.media.webally.co.za/logs/rewrite.log"
RewriteLogLevel 9

# Handle endpoints with parameters
RewriteRule ^preferences/(.*)$ preferences.php?path=$1 [L,QSA]
RewriteRule ^media/(.*)$ media.php?path=$1 [L,QSA]

# All other requests go through the index.php router
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# Prevent directory listing
Options -Indexes